

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Wavelength recalibration with the sky lines (Mendel OH bands) &mdash; Orcs 2.2.3 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/logo.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Orcs 2.2.3 documentation" href="index.html"/>
        <link rel="up" title="Examples" href="examples.html"/>
        <link rel="next" title="Image registration" href="script_example_image_registration.html"/>
        <link rel="prev" title="Modelling and fitting two unresolved emission lines with a bayesian approach" href="script_example_model+fit_2_lines_bayes.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Orcs
          

          
            
            <img src="_static/logo_sidebar.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2.2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="examples.html#first-basic-examples">First basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#bayesian-fitting-vs-classical-fitting">Bayesian fitting vs. classical fitting</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="examples.html#calibrating-your-data">Calibrating your data</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Wavelength recalibration with the sky lines (Mendel OH bands)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#First-step:-checking-the-calibration">First step: checking the calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Second-step:-Mapping-the-sky-velocity">Second step: Mapping the sky velocity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Resulting-data">Resulting data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Calibrating-your-data-with-the-sky-velocity-map">Calibrating your data with the sky velocity map</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="script_example_image_registration.html">Image registration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced-fitting">Advanced fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#other-tools">Other Tools</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core_module.html">Core module</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_module.html">Process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rvcorrect_module.html">RVCorrect module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils_module.html">Utils module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known Issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Orcs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="examples.html">Examples</a> &raquo;</li>
        
      <li>Wavelength recalibration with the sky lines (Mendel OH bands)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/script_example_wavelength_calibration.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="Wavelength-recalibration-with-the-sky-lines-(Mendel-OH-bands)">
<h1>Wavelength recalibration with the sky lines (Mendel OH bands)<a class="headerlink" href="#Wavelength-recalibration-with-the-sky-lines-(Mendel-OH-bands)" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>Data can be recalibrated in wavelength easily when one OH sky lines are
visible in most parts of the field of view. Cubes observed in the red
part of the spectrum (e.g. SN3 filter) are especially interesting in
this respect.</p>
<p>The general idea is to extract integrated spectra at different positions
in the field of view and measure the velocity of the sky lines (which
should be 0 if the calibration was perfect) (see <a class="reference external" href="https://arxiv.org/abs/1707.01366">Martin et al.
2017a</a>).</p>
<div class="figure" id="id1">
<img alt="skymap-fig0.svg" src="_images/skymap-fig0.svg" /><p class="caption"><span class="caption-text">skymap-fig0.svg</span></p>
</div>
<p>Then the correction map can be infered at each pixel by fitting a model.</p>
<div class="figure" id="id2">
<img alt="skymap-fig1.svg" src="_images/skymap-fig1.svg" /><p class="caption"><span class="caption-text">skymap-fig1.svg</span></p>
</div>
<p>The calibration model is based on a simple modeling of the
interferometer.</p>
<div class="figure" id="id3">
<img alt="coords0.svg" src="_images/coords0.svg" /><p class="caption"><span class="caption-text">coords0.svg</span></p>
</div>
</div>
<div class="section" id="First-step:-checking-the-calibration">
<h2>First step: checking the calibration<a class="headerlink" href="#First-step:-checking-the-calibration" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># inline plotting for jupyter notebook. Do not put this line in a real python script.</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># import base class for the manipulation of a SITELLE spectral cube: HDFCube</span>
<span class="kn">from</span> <span class="nn">orcs.process</span> <span class="kn">import</span> <span class="n">SpectralCube</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># load spectral cube</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">SpectralCube</span><span class="p">(</span><span class="s1">&#39;/home/thomas/M31_SN3.merged.cm1.1.0.hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Data shape : (2048, 2064, 840)
INFO| Cube is in WAVENUMBER (cm-1)
INFO| Cube is CALIBRATED in wavenumber
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># extract and plot a spectrum of a large integrated region. The sky lines should appear.</span>
<span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">extract_spectrum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Number of integrated pixels: 1257
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.292 s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Init of the parallel processing server with 16 threads
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.584 s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(14500, 15500)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_5_5.png" src="_images/script_example_wavelength_calibration_5_5.png" />
</div>
</div>
<div class="section" id="fitting-the-sky-spectrum">
<h3>fitting the sky spectrum<a class="headerlink" href="#fitting-the-sky-spectrum" title="Permalink to this headline">¶</a></h3>
<p>we can also fit the integrated spectrum because there si a large number
of sky lines and because we are not interested in a perfect fit (only
the velocity is required), we can use a simple &#8216;sinc&#8217; model with a fixed
fwhm. All the lines are set to share the same velocity parameter and we
set an inital guess of the velocity around 80 km/s. This general bias of
80 km/s is known (<a class="reference external" href="https://arxiv.org/abs/1706.03230">Martin et al.
2017b</a>) and comes from the error
made on the real wavelength of the calibration laser (which is falsely
considered to be at 453.5 nm).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">sky_lines_cm1</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_sky_lines</span><span class="p">()</span>
<span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">fit_res</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">fit_lines_in_spectrum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">sky_lines_cm1</span><span class="p">,</span>
                                                     <span class="n">fmodel</span><span class="o">=</span><span class="s1">&#39;sinc&#39;</span><span class="p">,</span>
                                                     <span class="n">pos_def</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                                     <span class="n">fwhm_def</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                                                     <span class="n">nofilter</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                     <span class="n">pos_cov</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">===== Results ======&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Velocity: &#39;</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;velocity_gvar&#39;</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;fitted_vector&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Number of integrated pixels: 1257
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.020 s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Init of the parallel processing server with 16 threads
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.559 s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-yellow-fg">WARNING| /home/thomas/Astro/Python/ORB/Orcs/orcs/core.py:1546: RuntimeWarning: invalid value encountered in sqrt
  noise_counts = np.sqrt(total_counts)
</span>
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

===== Results ======
Velocity:  [72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5) 72.5(1.5)
 72.5(1.5) 72.5(1.5)]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(14500, 15500)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_7_7.png" src="_images/script_example_wavelength_calibration_7_7.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Second-step:-Mapping-the-sky-velocity">
<h2>Second step: Mapping the sky velocity<a class="headerlink" href="#Second-step:-Mapping-the-sky-velocity" title="Permalink to this headline">¶</a></h2>
<p>Warning: this process can take a long time because a spectrum is
extracted and fitted for each point of a 40x40 grid by default. For a
basic example it is recommended to limit the number of grid division to
10x10.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">cube</span><span class="o">.</span><span class="n">map_sky_velocity</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">div_nb</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># the mean velocity bias is set around 80 km/s</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| fitting process already done. Do you really want to redo it again ?
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
type [yes]: yes
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| X range: 0 2048, Y range: 0 2064
INFO| Radius: 85.3333333333
INFO| 100 regions to fit
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 loading region: Shape : circle ( Number(1861.81818),Number(1876.36364),Number(85.33333) )
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Fitting region 0/100
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>


</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Velocity of the first line (km/s): 75.5(1.2)
INFO| Fitting region 1/100
INFO| Velocity of the first line (km/s): 75.8(1.2)
INFO| Fitting region 2/100
INFO| Velocity of the first line (km/s): 73.8(1.5)
INFO| Fitting region 3/100
INFO| Velocity of the first line (km/s): 71.6(1.4)
INFO| Fitting region 4/100
INFO| Velocity of the first line (km/s): 72.5(1.7)
INFO| Fitting region 5/100
INFO| Velocity of the first line (km/s): 69.9(1.6)
INFO| Fitting region 6/100
INFO| Velocity of the first line (km/s): 67.5(1.6)
INFO| Fitting region 7/100
INFO| Velocity of the first line (km/s): 66.6(1.5)
INFO| Fitting region 8/100
INFO| Velocity of the first line (km/s): 72.7(1.5)
INFO| Fitting region 9/100
INFO| Velocity of the first line (km/s): 70.7(2.0)
INFO| Fitting region 10/100
INFO| Velocity of the first line (km/s): 77.0(1.3)
INFO| Fitting region 11/100
INFO| Velocity of the first line (km/s): 76.6(1.3)
INFO| Fitting region 12/100
INFO| Velocity of the first line (km/s): 77.0(1.3)
INFO| Fitting region 13/100
INFO| Velocity of the first line (km/s): 72.7(1.5)
INFO| Fitting region 14/100
INFO| Velocity of the first line (km/s): 70.2(1.6)
INFO| Fitting region 15/100
INFO| Velocity of the first line (km/s): 65.8(1.5)
INFO| Fitting region 16/100
INFO| Velocity of the first line (km/s): 67.8(1.5)
INFO| Fitting region 17/100
INFO| Velocity of the first line (km/s): 68.4(1.6)
INFO| Fitting region 18/100
INFO| Velocity of the first line (km/s): 67.5(1.5)
INFO| Fitting region 19/100
INFO| Velocity of the first line (km/s): 71.9(1.7)
INFO| Fitting region 20/100
INFO| Velocity of the first line (km/s): 77.5(1.4)
INFO| Fitting region 21/100
INFO| Velocity of the first line (km/s): 78.0(1.3)
INFO| Fitting region 22/100
INFO| Velocity of the first line (km/s): 76.9(1.3)
INFO| Fitting region 23/100
INFO| Velocity of the first line (km/s): 74.6(1.5)
INFO| Fitting region 24/100
INFO| Velocity of the first line (km/s): 76.3(1.6)
INFO| Fitting region 25/100
INFO| Velocity of the first line (km/s): 78.7(1.7)
INFO| Fitting region 26/100
INFO| Velocity of the first line (km/s): 95.6(1.8)
INFO| Fitting region 27/100
INFO| Velocity of the first line (km/s): 61.9(1.6)
INFO| Fitting region 28/100
INFO| Velocity of the first line (km/s): 59.6(1.4)
INFO| Fitting region 29/100
INFO| Velocity of the first line (km/s): 73.7(1.5)
INFO| Fitting region 30/100
INFO| Velocity of the first line (km/s): 78.5(1.2)
INFO| Fitting region 31/100
INFO| Velocity of the first line (km/s): 77.0(1.3)
INFO| Fitting region 32/100
INFO| Velocity of the first line (km/s): 77.4(1.7)
INFO| Fitting region 33/100
INFO| Velocity of the first line (km/s): 62.9(1.8)
INFO| Fitting region 34/100
INFO| Velocity of the first line (km/s): 71.5(2.0)
INFO| Fitting region 35/100
INFO| Velocity of the first line (km/s): 83.8(2.1)
INFO| Fitting region 36/100
INFO| Velocity of the first line (km/s): 102.3(2.3)
INFO| Fitting region 37/100
INFO| Velocity of the first line (km/s): 54.1(1.6)
INFO| Fitting region 38/100
INFO| Velocity of the first line (km/s): 50.8(1.5)
INFO| Fitting region 39/100
INFO| Velocity of the first line (km/s): 75.2(1.3)
INFO| Fitting region 40/100
INFO| Velocity of the first line (km/s): 78.6(1.3)
INFO| Fitting region 41/100
INFO| Velocity of the first line (km/s): 73.2(1.9)
INFO| Fitting region 42/100
INFO| Velocity of the first line (km/s): 80.2(1.9)
INFO| Fitting region 43/100
INFO| Velocity of the first line (km/s): 96.9(2.4)
INFO| Fitting region 44/100
INFO| Velocity of the first line (km/s): 68.6(2.7)
INFO| Fitting region 45/100
INFO| Velocity of the first line (km/s): 77.2(2.0)
INFO| Fitting region 46/100
INFO| Velocity of the first line (km/s): 70.0(1.7)
INFO| Fitting region 47/100
INFO| Velocity of the first line (km/s): 109.7(2.0)
INFO| Fitting region 48/100
INFO| Velocity of the first line (km/s): 79.8(1.6)
INFO| Fitting region 49/100
INFO| Velocity of the first line (km/s): 74.7(1.2)
INFO| Fitting region 50/100
INFO| Velocity of the first line (km/s): 79.2(1.3)
INFO| Fitting region 51/100
INFO| Velocity of the first line (km/s): 76.9(1.5)
INFO| Fitting region 52/100
INFO| Velocity of the first line (km/s): 80.0(2.2)
INFO| Fitting region 53/100
INFO| Velocity of the first line (km/s): 91.5(2.6)
INFO| Fitting region 54/100
INFO| Velocity of the first line (km/s): 91.9(2.9)
INFO| Fitting region 55/100
INFO| Velocity of the first line (km/s): 85.7(2.9)
INFO| Fitting region 56/100
INFO| Velocity of the first line (km/s): 106.5(2.1)
INFO| Fitting region 57/100
INFO| Velocity of the first line (km/s): 78.5(1.9)
INFO| Fitting region 58/100
INFO| Velocity of the first line (km/s): 75.3(1.5)
INFO| Fitting region 59/100
INFO| Velocity of the first line (km/s): 77.5(1.1)
INFO| Fitting region 60/100
INFO| Velocity of the first line (km/s): 79.5(1.4)
INFO| Fitting region 61/100
INFO| Velocity of the first line (km/s): 78.3(1.7)
INFO| Fitting region 62/100
INFO| Velocity of the first line (km/s): 80.7(2.6)
INFO| Fitting region 63/100
INFO| Velocity of the first line (km/s): 78.4(2.6)
INFO| Fitting region 64/100
INFO| Velocity of the first line (km/s): 83.0(2.6)
INFO| Fitting region 65/100
INFO| Velocity of the first line (km/s): 61.3(2.4)
INFO| Fitting region 66/100
INFO| Velocity of the first line (km/s): 76.4(2.2)
INFO| Fitting region 67/100
INFO| Velocity of the first line (km/s): 77.7(1.7)
INFO| Fitting region 68/100
INFO| Velocity of the first line (km/s): 73.6(1.4)
INFO| Fitting region 69/100
INFO| Velocity of the first line (km/s): 80.7(1.7)
INFO| Fitting region 70/100
INFO| Velocity of the first line (km/s): 80.2(1.4)
INFO| Fitting region 71/100
INFO| Velocity of the first line (km/s): 80.5(1.5)
INFO| Fitting region 72/100
INFO| Velocity of the first line (km/s): 82.6(2.5)
INFO| Fitting region 73/100
INFO| Velocity of the first line (km/s): 79.7(2.5)
INFO| Fitting region 74/100
INFO| Velocity of the first line (km/s): 80.8(2.7)
INFO| Fitting region 75/100
INFO| Velocity of the first line (km/s): 83.9(2.3)
INFO| Fitting region 76/100
INFO| Velocity of the first line (km/s): 78.4(1.9)
INFO| Fitting region 77/100
INFO| Velocity of the first line (km/s): 72.5(1.3)
INFO| Fitting region 78/100
INFO| Velocity of the first line (km/s): 77.2(1.2)
INFO| Fitting region 79/100
INFO| Velocity of the first line (km/s): 80.00(98)
INFO| Fitting region 80/100
INFO| Velocity of the first line (km/s): 84.2(1.5)
INFO| Fitting region 81/100
INFO| Velocity of the first line (km/s): 81.0(1.4)
INFO| Fitting region 82/100
INFO| Velocity of the first line (km/s): 86.3(1.7)
INFO| Fitting region 83/100
INFO| Velocity of the first line (km/s): 82.1(2.0)
INFO| Fitting region 84/100
INFO| Velocity of the first line (km/s): 87.0(2.0)
INFO| Fitting region 85/100
INFO| Velocity of the first line (km/s): 81.8(1.9)
INFO| Fitting region 86/100
INFO| Velocity of the first line (km/s): 80.5(1.6)
INFO| Fitting region 87/100
INFO| Velocity of the first line (km/s): 82.4(1.1)
INFO| Fitting region 88/100
INFO| Velocity of the first line (km/s): 80.33(93)
INFO| Fitting region 89/100
INFO| Velocity of the first line (km/s): 86.09(89)
INFO| Fitting region 90/100
INFO| Velocity of the first line (km/s): 84.4(1.7)
INFO| Fitting region 91/100
INFO| Velocity of the first line (km/s): 82.8(1.4)
INFO| Fitting region 92/100
INFO| Velocity of the first line (km/s): 82.3(1.6)
INFO| Fitting region 93/100
INFO| Velocity of the first line (km/s): 83.9(1.7)
INFO| Fitting region 94/100
INFO| Velocity of the first line (km/s): 83.9(1.5)
INFO| Fitting region 95/100
INFO| Velocity of the first line (km/s): 85.7(1.4)
INFO| Fitting region 96/100
INFO| Velocity of the first line (km/s): 83.8(1.1)
INFO| Fitting region 97/100
INFO| Velocity of the first line (km/s): 83.41(78)
INFO| Fitting region 98/100
INFO| Velocity of the first line (km/s): 83.27(81)
INFO| Fitting region 99/100
INFO| Velocity of the first line (km/s): 83.79(69)
<span class="ansi-yellow-fg">WARNING| /home/thomas/Astro/Python/ORB/Orcs/orcs/process.py:329: RuntimeWarning: invalid value encountered in greater
  sky_vel_map[sky_vel_map &gt; np.nanpercentile(sky_vel_map, 95)] = np.nan
</span>
INFO| Angle at the center of the frame: 15.4961376587
<span class="ansi-yellow-fg">WARNING| /home/thomas/Astro/Python/ORB/Orb/orb/utils/image.py:1054: RuntimeWarning: invalid value encountered in less
  calib_laser_map[np.nonzero(calib_laser_map &lt; value_min)] = np.nan
</span>
INFO| &gt; Binning calibration map
<span class="ansi-yellow-fg">WARNING| /home/thomas/Astro/Python/ORB/Orb/orb/utils/image.py:938: RuntimeWarning: Mean of empty slice
  return np.squeeze(np.nanmean(np.nanmean(im_view, axis=3), axis=1))
</span>
INFO| &gt; Calibration laser map fit
INFO|   &gt; First fit on the central portion of the calibration laser map (30.0% of the total size)
INFO|     &gt; Calibration laser map fit parameters:
    distance to mirror: 23.6929484545 cm
    X angle from the optical axis to the center: 0.0 degrees (Fixed)
    Y angle from the optical axis to the center: 15.5034960221 degrees
    Tip-tilt angle of the detector along X: 0.0 degrees (Fixed)
    Tip-tilt angle of the detector along Y: 0.0 degrees (Fixed)
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.360354174 nm (Fixed)
    Error on fit: mean -1.14694114185e-06, std 0.0515053233379 (in nm)
    Error on fit: mean -0.000633248892585, std 28.4371078653 (in km/s)
INFO|   &gt; Second fit on the central portion of the calibration laser map (30.0% of the total size)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
First laser wavelentgh calibration estimation: 543.360354174 nm
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO|     &gt; Calibration laser map fit parameters:
    distance to mirror: 23.6769550191 cm
    X angle from the optical axis to the center: -0.467348573066 degrees
    Y angle from the optical axis to the center: 15.4964389183 degrees
    Tip-tilt angle of the detector along X: 0.427738947088 degrees
    Tip-tilt angle of the detector along Y: -1.22059704838 degrees
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.360354174 nm (Fixed)
    Error on fit: mean -3.79483279357e-07, std 0.000789304258014 (in nm)
    Error on fit: mean -0.000209520225266, std 0.435790494439 (in km/s)
INFO|   &gt; Third fit on a larger portion of the map (50.0% of the total size)
INFO|     &gt; Calibration laser map fit parameters:
    distance to mirror: 23.7139686185 cm
    X angle from the optical axis to the center: -0.46771103975 degrees
    Y angle from the optical axis to the center: 15.496813076 degrees
    Tip-tilt angle of the detector along X: 0.301189457349 degrees
    Tip-tilt angle of the detector along Y: -0.70067458497 degrees
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.360354174 nm (Fixed)
    Error on fit: mean -2.73349405071e-06, std 0.00312197276085 (in nm)
    Error on fit: mean -0.0015092161379, std 1.72370291844 (in km/s)
INFO|   &gt; Zernike polynomials fit of the residual wavefront
<span class="ansi-yellow-fg">WARNING| /home/thomas/Astro/Python/ORB/Orb/orb/ext/zern.py:54: DeprecationWarning: object of type &lt;type &#39;float&#39;&gt; cannot be safely interpreted as an integer.
  r0v = np.linspace(-1-center[0], 1-center[0], r0).astype(dtype).reshape(-1,1)
</span>
<span class="ansi-yellow-fg">WARNING| /home/thomas/Astro/Python/ORB/Orb/orb/ext/zern.py:55: DeprecationWarning: object of type &lt;type &#39;float&#39;&gt; cannot be safely interpreted as an integer.
  r1v = np.linspace(-1-center[1], 1-center[1], r1).astype(dtype).reshape(1,-1)
</span>
INFO| Standard deviation of the residual: 1.84989074611e-05
INFO| Median relative error (err/val)): 0.05%
INFO| &gt; final error (std on 50.0% of the total size): 1.764e-05 nm, 9.739e-03 km/s
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    &gt; New calibration laser map fit parameters:
    distance to mirror: 23.6630434546 cm
    X angle from the optical axis to the center: -0.0972147989421 degrees
    Y angle from the optical axis to the center: 15.4797965758 degrees
    Tip-tilt angle of the detector along X: 4.69894825761 degrees
    Tip-tilt angle of the detector along Y: 0.336872109582 degrees
    Rotation angle of the detector: 1.38202531904 degrees
    Calibration laser wavelength: 543.42604743 nm

fit residual std (in km/s): 2.22847256858
median error on the data (in km/s) 1.44334722958
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Data written as M31_SN3.1.0.ORCS/M31_SN3.1.0.calibration_laser_map.fits in 0.13 s
INFO| Data written as M31_SN3.1.0.ORCS/M31_SN3.1.0.wavefront_map.fits in 0.23 s
INFO| Data written as M31_SN3.1.0.ORCS/M31_SN3.1.0.skymap.fits in 0.16 s
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_11.png" src="_images/script_example_wavelength_calibration_9_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_12.png" src="_images/script_example_wavelength_calibration_9_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_13.png" src="_images/script_example_wavelength_calibration_9_13.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_14.png" src="_images/script_example_wavelength_calibration_9_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_15.png" src="_images/script_example_wavelength_calibration_9_15.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_9_16.png" src="_images/script_example_wavelength_calibration_9_16.png" />
</div>
</div>
</div>
<div class="section" id="Resulting-data">
<h2>Resulting data<a class="headerlink" href="#Resulting-data" title="Permalink to this headline">¶</a></h2>
<p>The most important result is the skymap which gives the modelized
velocity of the sky in the field of view and permit to correct the
measured velocities in the cube.This map is named <code class="docutils literal"><span class="pre">*skymap.fits</span></code>.</p>
<p>In this particular case this is
<code class="docutils literal"><span class="pre">M31_SN3.1.0.ORCS/M31_SN3.1.0.skymap.fits</span></code></p>
<p>The histogram displays the difference between the measured velocity and
the fitted velocity at each valid data point.</p>
<p>You can see by looking at the other maps that in the cas of M31 there
are some data points at the center of the field which could not give a
valid velocity of the sky. This comes from the fact that M31 is very
bright at the center and the sky lines are lost in the noise produced by
the high continuum background. Modelling the interferometer makes
possible to estimate the velocity of the lines at the center of the
field where no real data has been obtained. And the result is stricking,
it works particularly well even if the case of M31 (<a class="reference external" href="https://arxiv.org/abs/1707.01366">Martin et al.
2017a</a>)</p>
</div>
<div class="section" id="Calibrating-your-data-with-the-sky-velocity-map">
<h2>Calibrating your data with the sky velocity map<a class="headerlink" href="#Calibrating-your-data-with-the-sky-velocity-map" title="Permalink to this headline">¶</a></h2>
<p>Once the velocity map is passed to the SpectralCube class, the class
will internaly make the appropriate corrections so that the measured
velocity of any spectrum will be corrected. But it will also correct the
spectral misalignment of the spectra before extracting the data which
should have an effect on the broadening of the lines when a spectrum is
integrated over a large field of view with a non-negligible gradient on
the velocity calibration.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># the computed sky velocity map is passed to cube</span>
<span class="n">cube</span><span class="o">.</span><span class="n">correct_wavelength</span><span class="p">(</span><span class="s1">&#39;M31_SN3.1.0.ORCS/M31_SN3.1.0.skymap.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># The same sky spectrum is now extracted and fitted and the measured velocity is now similar to 0 km/s.</span>
<span class="c1"># Note that the calibration map used here has not been calculated with a 40x40 grid. The calibration</span>
<span class="c1"># quality would have been better in this case.</span>

<span class="n">sky_lines_cm1</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_sky_lines</span><span class="p">()</span>
<span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">fit_res</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">fit_lines_in_spectrum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">sky_lines_cm1</span><span class="p">,</span>
                                                     <span class="n">fmodel</span><span class="o">=</span><span class="s1">&#39;sinc&#39;</span><span class="p">,</span>
                                                     <span class="n">pos_def</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                                     <span class="n">fwhm_def</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                                                     <span class="n">nofilter</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                     <span class="n">pos_cov</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">===== Results ======&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Velocity: &#39;</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;velocity_gvar&#39;</span><span class="p">]</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;fitted_vector&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Number of integrated pixels: 1257
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.028 s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
INFO| Init of the parallel processing server with 16 threads
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 0.701 s]

===== Results ======
Velocity:  [-1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5) -1.2(1.5)
 -1.2(1.5) -1.2(1.5)]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[8]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(14500, 15500)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_13_5.png" src="_images/script_example_wavelength_calibration_13_5.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="script_example_image_registration.html" class="btn btn-neutral float-right" title="Image registration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="script_example_model+fit_2_lines_bayes.html" class="btn btn-neutral" title="Modelling and fitting two unresolved emission lines with a bayesian approach" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Thomas Martin (thomas.martin.1@ulaval.ca).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>