

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Wavelength recalibration with the sky lines (Mendel OH bands) &mdash; Orcs latest documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/logo.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Image registration" href="script_example_image_registration.html" />
    <link rel="prev" title="Modelling and fitting two unresolved emission lines with a bayesian approach" href="script_example_model+fit_2_lines_bayes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Orcs
          

          
            
            <img src="_static/logo_sidebar.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                lastest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="examples.html#first-basic-examples">First basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#bayesian-fitting-vs-classical-fitting">Bayesian fitting vs. classical fitting</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="examples.html#calibrating-your-data">Calibrating your data</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Wavelength recalibration with the sky lines (Mendel OH bands)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#First-step:-checking-the-calibration">First step: checking the calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Second-step:-Mapping-the-sky-velocity">Second step: Mapping the sky velocity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Ouputs">Ouputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="script_example_image_registration.html">Image registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="script_example_hst_flux_calibration.html">Flux Calibration Example Using HST image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced-fitting">Advanced fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#other-tools">Other Tools</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core_module.html">Core module</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_module.html">Process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils_module.html">Utils module</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known Issues</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Orcs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="examples.html">Examples</a> &raquo;</li>
        
      <li>Wavelength recalibration with the sky lines (Mendel OH bands)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/script_example_wavelength_calibration.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Wavelength-recalibration-with-the-sky-lines-(Mendel-OH-bands)">
<h1>Wavelength recalibration with the sky lines (Mendel OH bands)<a class="headerlink" href="#Wavelength-recalibration-with-the-sky-lines-(Mendel-OH-bands)" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>Data can be recalibrated in wavelength easily when one OH sky lines are visible in most parts of the field of view. Cubes observed in the red part of the spectrum (e.g. SN3 filter) are especially interesting in this respect.</p>
<p>The general idea is to extract integrated spectra at different positions in the field of view and measure the velocity of the sky lines (which should be 0 if the calibration was perfect) (see <a class="reference external" href="https://arxiv.org/abs/1707.01366">Martin et al. 2017a</a>).</p>
<p><img alt="skymap-fig0.svg" src="_images/skymap-fig0.svg" /></p>
<p>Then the correction map can be infered at each pixel by fitting a model.</p>
<p><img alt="skymap-fig1.svg" src="_images/skymap-fig1.svg" /></p>
<p>The calibration model is based on a simple modeling of the interferometer.</p>
<p><img alt="coords0.svg" src="_images/coords0.svg" /></p>
</div>
<div class="section" id="First-step:-checking-the-calibration">
<h2>First step: checking the calibration<a class="headerlink" href="#First-step:-checking-the-calibration" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># import base class for the manipulation of a SITELLE spectral cube: HDFCube</span>
<span class="kn">from</span> <span class="nn">orcs.process</span> <span class="kn">import</span> <span class="n">SpectralCube</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pl</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># load spectral cube</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">SpectralCube</span><span class="p">(</span><span class="s1">&#39;/home/thomas/M31_SN3.merged.cm1.1.0.hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
master.fa09a|INFO| Cube is level 3
master.fa09a|INFO| shape: (2048, 2064, 840)
master.fa09a|INFO| wavenumber calibration: True
master.fa09a|INFO| flux calibration: True
master.fa09a|INFO| wcs calibration: True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># extract and plot a spectrum of a large integrated region. Sky lines should be visible.</span>
<span class="n">spectrum</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_spectrum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(14500, 15500)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_4_1.png" src="_images/script_example_wavelength_calibration_4_1.png" />
</div>
</div>
<div class="section" id="fitting-the-sky-spectrum">
<h3>fitting the sky spectrum<a class="headerlink" href="#fitting-the-sky-spectrum" title="Permalink to this headline">¶</a></h3>
<p>we can also fit the integrated spectrum because there si a large number of sky lines and because we are not interested in a perfect fit (only the velocity is required), we can use a simple ‘sinc’ model with a fixed fwhm. All the lines are set to share the same velocity parameter and we set an inital guess of the velocity around 80 km/s. This general bias of 80 km/s is known (<a class="reference external" href="https://arxiv.org/abs/1706.03230">Martin et al. 2017b</a>) and comes from the error made on the real wavelength of the
calibration laser (which is falsely considered to be at 453.5 nm).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sky_lines_cm1</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">get_sky_lines</span><span class="p">()</span>
<span class="n">fit_res</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sky_lines_cm1</span><span class="p">,</span>
                       <span class="n">fmodel</span><span class="o">=</span><span class="s1">&#39;sinc&#39;</span><span class="p">,</span>
                       <span class="n">pos_def</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                       <span class="n">fwhm_def</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                       <span class="n">nofilter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">pos_cov</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Velocity: &#39;</span><span class="p">,</span> <span class="n">fit_res</span><span class="p">[</span><span class="s1">&#39;velocity_gvar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">fit_res</span><span class="o">.</span><span class="n">get_spectrum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">14500</span><span class="p">,</span> <span class="mi">15500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Velocity:  77.5(1.5)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(14500, 15500)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_6_2.png" src="_images/script_example_wavelength_calibration_6_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Second-step:-Mapping-the-sky-velocity">
<h2>Second step: Mapping the sky velocity<a class="headerlink" href="#Second-step:-Mapping-the-sky-velocity" title="Permalink to this headline">¶</a></h2>
<p>Warning: this process can take a long time because a spectrum is extracted and fitted for each point of a 40x40 grid by default. For a basic example it is recommended to limit the number of grid division to 10x10.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cube</span><span class="o">.</span><span class="n">map_sky_velocity</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">div_nb</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">exclude_reg_file_path</span><span class="o">=</span><span class="s1">&#39;m31_exclude.reg&#39;</span><span class="p">)</span> <span class="c1"># the mean velocity bias is set around 80 km/s</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
master.fa09a|INFO| fitting process already done ! set no_fit=True if you do not want to redo it
master.fa09a|INFO| X range: 0 2048, Y range: 0 2064
master.fa09a|INFO| Radius: 30
master.fa09a|INFO| excluding region from file m31_exclude.reg
master.fa09a|INFO| 58 regions to fit
master.fa09a|INFO| 88 sky lines to fit
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 loading region: Shape : circle ( Number(1861.81818),Number(1876.36364),Number(30.00000) )

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
master.fa09a|INFO| Init of the parallel processing server with 32 threads
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 [==========] [100%] [completed in 2m51s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
master.fa09a|INFO| Closing parallel processing server
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
master.fa09a|INFO| parallel processing closed
master.fa09a|INFO| Velocity of the first line (km/s): 78.9(2.2)
master.fa09a|INFO| Velocity of the first line (km/s): 76.3(2.0)
master.fa09a|INFO| Velocity of the first line (km/s): 71.8(1.9)
master.fa09a|INFO| Velocity of the first line (km/s): 70.3(2.4)
master.fa09a|INFO| Velocity of the first line (km/s): 71.7(2.8)
master.fa09a|INFO| Velocity of the first line (km/s): 67.1(2.6)
master.fa09a|INFO| Velocity of the first line (km/s): 65.2(2.4)
master.fa09a|INFO| Velocity of the first line (km/s): 59.3(2.4)
master.fa09a|INFO| Velocity of the first line (km/s): 61.5(2.3)
master.fa09a|INFO| Velocity of the first line (km/s): 61.1(2.3)
master.fa09a|INFO| Velocity of the first line (km/s): 75.1(2.0)
master.fa09a|INFO| Velocity of the first line (km/s): 76.0(2.1)
master.fa09a|INFO| Velocity of the first line (km/s): 77.7(2.3)
master.fa09a|INFO| Velocity of the first line (km/s): 72.4(3.2)
master.fa09a|INFO| Velocity of the first line (km/s): 69.7(3.3)
master.fa09a|INFO| Velocity of the first line (km/s): 56.5(2.8)
master.fa09a|INFO| Velocity of the first line (km/s): 68.3(3.0)
master.fa09a|INFO| Velocity of the first line (km/s): 62.0(3.2)
master.fa09a|INFO| Velocity of the first line (km/s): 62.5(2.6)
master.fa09a|INFO| Velocity of the first line (km/s): 60.2(2.3)
master.fa09a|INFO| Velocity of the first line (km/s): 77.9(2.2)
master.fa09a|INFO| Velocity of the first line (km/s): 77.9(2.4)
master.fa09a|INFO| Velocity of the first line (km/s): 73.6(2.7)
master.fa09a|INFO| Velocity of the first line (km/s): 48.6(2.8)
master.fa09a|INFO| Velocity of the first line (km/s): 62.4(2.8)
master.fa09a|INFO| Velocity of the first line (km/s): 78.3(2.3)
master.fa09a|INFO| Velocity of the first line (km/s): 74.6(2.8)
master.fa09a|INFO| Velocity of the first line (km/s): 103.1(3.4)
master.fa09a|INFO| Velocity of the first line (km/s): 68.7(2.7)
master.fa09a|INFO| Velocity of the first line (km/s): 76.1(2.9)
master.fa09a|INFO| Velocity of the first line (km/s): 78.8(3.3)
master.fa09a|INFO| Velocity of the first line (km/s): 67.5(2.4)
master.fa09a|INFO| Velocity of the first line (km/s): 79.9(3.2)
master.fa09a|INFO| Velocity of the first line (km/s): 74.7(3.1)
master.fa09a|INFO| Velocity of the first line (km/s): 70.6(2.2)
master.fa09a|INFO| Velocity of the first line (km/s): 79.5(3.0)
master.fa09a|INFO| Velocity of the first line (km/s): 66.5(2.6)
master.fa09a|INFO| Velocity of the first line (km/s): 68.1(2.2)
master.fa09a|INFO| Velocity of the first line (km/s): 73.3(3.1)
master.fa09a|INFO| Velocity of the first line (km/s): 59.8(2.7)
master.fa09a|INFO| Velocity of the first line (km/s): 66.9(2.4)
master.fa09a|INFO| Velocity of the first line (km/s): 70.8(1.9)
master.fa09a|INFO| Velocity of the first line (km/s): 81.4(3.2)
master.fa09a|INFO| Velocity of the first line (km/s): 80.2(3.7)
master.fa09a|INFO| Velocity of the first line (km/s): 70.7(3.1)
master.fa09a|INFO| Velocity of the first line (km/s): 77.3(2.6)
master.fa09a|INFO| Velocity of the first line (km/s): 70.1(1.8)
master.fa09a|INFO| Velocity of the first line (km/s): 74.8(1.4)
master.fa09a|INFO| Velocity of the first line (km/s): 79.9(3.2)
master.fa09a|INFO| Velocity of the first line (km/s): 78.4(3.0)
master.fa09a|INFO| Velocity of the first line (km/s): 77.9(3.4)
master.fa09a|INFO| Velocity of the first line (km/s): 77.4(3.2)
master.fa09a|INFO| Velocity of the first line (km/s): 76.2(3.6)
master.fa09a|INFO| Velocity of the first line (km/s): 74.8(2.9)
master.fa09a|INFO| Velocity of the first line (km/s): 75.3(2.2)
master.fa09a|INFO| Velocity of the first line (km/s): 75.7(1.7)
master.fa09a|INFO| Velocity of the first line (km/s): 71.6(1.6)
master.fa09a|INFO| Velocity of the first line (km/s): 74.3(1.3)
master.fa09a|INFO| x: [ 186.18181818  186.18181818  186.18181818  186.18181818  186.18181818
  186.18181818  186.18181818  186.18181818  186.18181818  186.18181818
  372.36363636  372.36363636  372.36363636  372.36363636  372.36363636
  372.36363636  372.36363636  372.36363636  372.36363636  372.36363636
  558.54545455  558.54545455  558.54545455  558.54545455  558.54545455
  744.72727273  744.72727273  744.72727273  744.72727273  930.90909091
  930.90909091  930.90909091 1117.09090909 1117.09090909 1117.09090909
 1303.27272727 1303.27272727 1303.27272727 1489.45454545 1489.45454545
 1489.45454545 1489.45454545 1675.63636364 1675.63636364 1675.63636364
 1675.63636364 1675.63636364 1675.63636364 1861.81818182 1861.81818182
 1861.81818182 1861.81818182 1861.81818182 1861.81818182 1861.81818182
 1861.81818182 1861.81818182 1861.81818182]
master.fa09a|INFO| y: [ 187.63636364  375.27272727  562.90909091  750.54545455  938.18181818
 1125.81818182 1313.45454545 1501.09090909 1688.72727273 1876.36363636
  187.63636364  375.27272727  562.90909091  750.54545455  938.18181818
 1125.81818182 1313.45454545 1501.09090909 1688.72727273 1876.36363636
  187.63636364  375.27272727  562.90909091 1688.72727273 1876.36363636
  187.63636364  375.27272727 1688.72727273 1876.36363636  187.63636364
  375.27272727 1876.36363636  187.63636364 1688.72727273 1876.36363636
  187.63636364 1688.72727273 1876.36363636  187.63636364 1501.09090909
 1688.72727273 1876.36363636  187.63636364  375.27272727 1313.45454545
 1501.09090909 1688.72727273 1876.36363636  187.63636364  375.27272727
  562.90909091  750.54545455  938.18181818 1125.81818182 1313.45454545
 1501.09090909 1688.72727273 1876.36363636]
master.fa09a|INFO| v: [ 78.86042362  76.2582753   71.82992727  70.32555007  71.72235552
  67.14847511  65.20581426  59.34883958  61.47513547  61.12081898
  75.14513547  76.0081303   77.70637615  72.44596251  69.74664224
  56.45854195  68.31005925  62.01759568  62.49686679  60.21924715
  77.91238292  77.94153777  73.6394465   48.57688216  62.35858405
  78.27470008  74.63956925 103.07600508  68.67205024  76.14311239
  78.83157028  67.46578524  79.91450518  74.74830252  70.61836475
  79.51063809  66.50691762  68.11838885  73.28617653  59.77590267
  66.89597323  70.75022847  81.37248121  80.17863546  70.68674844
  77.32174855  70.06751036  74.78571896  79.90117383  78.43339076
  77.92255972  77.35418943  76.19160053  74.84503818  75.31922486
  75.6812475   71.59869116  74.28001552]
<span class="ansi-yellow-fg">master.fa09a|WARNING| /home/thomas/Astro/Python/ORB/Orcs/orcs/utils.py:212: RuntimeWarning: invalid value encountered in greater
  vel[vel &gt; np.nanpercentile(vel, 95)] = np.nan
</span>
master.fa09a|INFO| First laser wavelentgh calibration estimation: 543.3701006659054 nm
master.fa09a|INFO| Angle at the center of the frame: 15.495422711743403
master.fa09a|INFO| &gt; Binning calibration map
<span class="ansi-yellow-fg">master.fa09a|WARNING| /home/thomas/Astro/Python/ORB/Orb/orb/utils/image.py:1074: RuntimeWarning: Mean of empty slice
  return np.squeeze(np.nanmean(np.nanmean(im_view, axis=3), axis=1))
</span>
master.fa09a|INFO| &gt; Calibration laser map fit
master.fa09a|INFO|   &gt; First fit on the central portion of the calibration laser map (30.0% of the total size)
master.fa09a|INFO|     &gt; Calibration laser map fit parameters:
    distance to mirror: 263936699.3150021 cm
    X angle from the optical axis to the center: 0.0 degrees (Fixed)
    Y angle from the optical axis to the center: 15.495422711743405 degrees
    Tip-tilt angle of the detector along X: 0.0 degrees (Fixed)
    Tip-tilt angle of the detector along Y: 0.0 degrees (Fixed)
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.3701006659054 nm (Fixed)
    Error on fit: mean -1.4861024538773338e-15, std 1.5695392288219445e-07 (in nm)
    Error on fit: mean -8.204918445399005e-13, std 8.665581121772023e-05 (in km/s)
master.fa09a|INFO|   &gt; Second fit on the central portion of the calibration laser map (30.0% of the total size)
master.fa09a|INFO|     &gt; Calibration laser map fit parameters:
    distance to mirror: 270667216.2431192 cm
    X angle from the optical axis to the center: 0.0 degrees
    Y angle from the optical axis to the center: 15.495422710465332 degrees
    Tip-tilt angle of the detector along X: 0.0 degrees
    Tip-tilt angle of the detector along Y: 0.003496501989666831 degrees
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.3701006659054 nm (Fixed)
    Error on fit: mean -3.4870814500274624e-09, std 1.5305104139895723e-07 (in nm)
    Error on fit: mean -1.9252521140309393e-06, std 8.450099179807189e-05 (in km/s)
master.fa09a|INFO|   &gt; Third fit on a larger portion of the map (50.0% of the total size)
master.fa09a|INFO|     &gt; Calibration laser map fit parameters:
    distance to mirror: 270667216.2431192 cm
    X angle from the optical axis to the center: 0.0 degrees
    Y angle from the optical axis to the center: 15.495422710465332 degrees
    Tip-tilt angle of the detector along X: 0.0 degrees
    Tip-tilt angle of the detector along Y: 0.0 degrees
    Rotation angle of the detector: 0.0 degrees (Fixed)
    Calibration laser wavelength: 543.3701006659054 nm (Fixed)
    Error on fit: mean -3.487084368513622e-09, std 2.5708928457980605e-07 (in nm)
    Error on fit: mean -1.925253725355977e-06, std 0.00014194153355037787 (in km/s)
master.fa09a|INFO|   &gt; Zernike polynomials fit of the residual wavefront
<span class="ansi-yellow-fg">master.fa09a|WARNING| &lt;string&gt;:6: DeprecationWarning: object of type &lt;class &#39;float&#39;&gt; cannot be safely interpreted as an integer.
</span>
<span class="ansi-yellow-fg">master.fa09a|WARNING| /home/thomas/Astro/Python/ORB/Orb/orb/ext/zern.py:300: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  wf_zern_vec = np.linalg.lstsq((zern_basismat[:, grid_vec] * weight).T, wf_w.ravel())[0]
</span>
master.fa09a|INFO| Standard deviation of the residual: 7.789107164675645e-11
master.fa09a|INFO| Median relative error (err/val)): 0.01%
master.fa09a|INFO| &gt; final error (std on 50.0% of the total size): 1.606e-11 nm, 8.865e-09 km/s
master.fa09a|INFO|     &gt; New calibration laser map fit parameters:
    distance to mirror: -282031697934.2675 cm
    X angle from the optical axis to the center: 0.0 degrees
    Y angle from the optical axis to the center: 15.569878356725365 degrees
    Tip-tilt angle of the detector along X: 0.0 degrees
    Tip-tilt angle of the detector along Y: 7.218995916765718 degrees
    Rotation angle of the detector: 0.0 degrees
    Calibration laser wavelength: 543.1740675641056 nm

master.fa09a|INFO| fit residual std (in km/s):
master.fa09a|INFO| median error on the data (in km/s)
master.fa09a|INFO| Data written as ./M31_SN3/M31_SN3.calibration_laser_map.fits in 0.16 s
master.fa09a|INFO| Data written as ./M31_SN3/M31_SN3.wavefront_map.fits in 0.14 s
master.fa09a|INFO| Data written as ./M31_SN3/M31_SN3.skymap.fits in 0.14 s
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_8_7.png" src="_images/script_example_wavelength_calibration_8_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_8_8.png" src="_images/script_example_wavelength_calibration_8_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_8_9.png" src="_images/script_example_wavelength_calibration_8_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_8_10.png" src="_images/script_example_wavelength_calibration_8_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_8_11.png" src="_images/script_example_wavelength_calibration_8_11.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_wavelength_calibration_8_12.png" src="_images/script_example_wavelength_calibration_8_12.png" />
</div>
</div>
</div>
<div class="section" id="Ouputs">
<h2>Ouputs<a class="headerlink" href="#Ouputs" title="Permalink to this headline">¶</a></h2>
<p>The most important output is the skymap which gives the modelized velocity of the sky in the field of view and permit to correct the measured velocities in the cube.This map is named <code class="docutils literal notranslate"><span class="pre">*skymap.fits</span></code>. You can add it to the obtained velocity maps to correct the velocity.</p>
<p>In this particular case this is <code class="docutils literal notranslate"><span class="pre">M31_SN3.1.0.ORCS/M31_SN3.1.0.skymap.fits</span></code></p>
<p>The histogram above shows the difference between the measured velocity and the fitted velocity at each valid data point.</p>
<p>You can see that there are some data points at the center of the field which were excluded from the fit. This comes from the fact that M31 is very bright at the center and the sky lines are lost in the noise produced by the high continuum background. Modelling the interferometer makes possible to estimate the velocity of the lines at the center of the field where no velocity measurement could be done. And the result is stricking, it works particularly well even if the case of M31 (<a class="reference external" href="https://arxiv.org/abs/1707.01366">Martin et
al. 2017a</a>)</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="script_example_image_registration.html" class="btn btn-neutral float-right" title="Image registration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="script_example_model+fit_2_lines_bayes.html" class="btn btn-neutral float-left" title="Modelling and fitting two unresolved emission lines with a bayesian approach" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Thomas Martin (thomas.martin.1@ulaval.ca)

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>