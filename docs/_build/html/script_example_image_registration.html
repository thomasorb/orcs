

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Image registration &mdash; Orcs latest documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/logo.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Flux Calibration Example Using HST image" href="script_example_hst_flux_calibration.html" />
    <link rel="prev" title="Wavelength recalibration with the sky lines (Mendel OH bands)" href="script_example_wavelength_calibration.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Orcs
          

          
            
            <img src="_static/logo_sidebar.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                lastest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="examples.html#first-basic-examples">First basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#automatic-velocity-and-flux-estimation-complete-examples">Automatic velocity and flux estimation (complete examples)</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#bayesian-fitting-vs-classical-fitting">Bayesian fitting vs. classical fitting</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="examples.html#calibrating-your-data">Calibrating your data</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="script_example_wavelength_calibration.html">Wavelength recalibration with the sky lines (Mendel OH bands)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Image registration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Initial-calibration">Initial calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Final-calibration">Final calibration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Check-the-results">Check the results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="script_example_hst_flux_calibration.html">Flux Calibration Example Using HST image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#advanced-fitting">Advanced fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples.html#other-tools">Other Tools</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core_module.html">Core module</a></li>
<li class="toctree-l1"><a class="reference internal" href="fit_module.html">Fit module</a></li>
<li class="toctree-l1"><a class="reference internal" href="process_module.html">Process module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils_module.html">Utils module</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Orcs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="examples.html">Examples</a> &raquo;</li>
        
      <li>Image registration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/script_example_image_registration.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Image-registration">
<h1>Image registration<a class="headerlink" href="#Image-registration" title="Permalink to this headline">¶</a></h1>
<p>In some cases a calibration image of a field containing a lot of stars obtained with SITELLE in the same filter and during the same run as the science data can be used to compute a distortion model that can be then used directly to enhance the astrometrical calibration of the science cube which may have much less stars. The distortion model is then kept as is and only the basic registration parameters are recomputed (see Martin el al. 2017, <a class="reference external" href="http://adsabs.harvard.edu/abs/2017arXiv170701366M">http://adsabs.harvard.edu/abs/2017arXiv170701366M</a>)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">import</span> <span class="nn">orb.image</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># useful to get logging output. orb and orcs use the logging package which is automatically set to INFO level when a cube is loaded.</span>
<span class="c1"># But, as we are not loading a cube this time and only working on images, you must do it manually.</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Initial-calibration">
<h2>Initial calibration<a class="headerlink" href="#Initial-calibration" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">target_ra</span></code> and <code class="docutils literal notranslate"><span class="pre">target_dec</span></code> are the celestial coordinates at the center of the image.</p>
<p><strong>note: this process can be done in two steps. For the first step we are only concerned with the calibration of the center of the image. During the second step a distortion model is computed over the whole field of view</strong>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">im</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;M1-71_SN3.merged.InterferogramMerger.deep_frame.fits&#39;</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="s1">&#39;sitelle&#39;</span><span class="p">)</span>
<span class="c1"># in case any wrong wcs parameters were stored in the header, it is safe to reset the wcs to get a fresh start before the registration.</span>
<span class="n">im</span><span class="o">.</span><span class="n">reset_wcs</span><span class="p">(</span><span class="mf">294.1120729</span><span class="p">,</span> <span class="mf">19.70678597</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># the HDF5 format is the native format for orb and orcs and you are sure to keep all the data with it.</span>
<span class="c1"># But for an image you can, in principle, safely use the fits format.</span>
<span class="n">im</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;M1-71.deep_frame.wcs.init.hdf5&#39;</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">to_fits</span><span class="p">(</span><span class="s1">&#39;M1-71.deep_frame.wcs.init.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:root:Data written as M1-71.deep_frame.wcs.init.fits in 0.05 s
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># now we will check the results of the calibration by loading the positions of the stars in the field from the gaia catalog</span>
<span class="c1"># before plotting them on the image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;M1-71.deep_frame.wcs.init.hdf5&#39;</span><span class="p">)</span>
<span class="n">sl</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_stars_from_catalog</span><span class="p">(</span><span class="n">max_stars</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:root:Sending query to VizieR server (catalog: gaia2)
INFO:root:Looking for stars at RA: 294.113293 DEC: 19.706693
INFO:root:1000 stars recorded in the given field
INFO:root:Magnitude min: 9.5522, max:17.1995
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sl</span> <span class="c1"># the catalog position ra, dec as well as their positions in pixels are stroed in a pandas.DataFrame object</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>ra</th>
      <th>dec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1264.454377</td>
      <td>286.145713</td>
      <td>294.091757</td>
      <td>19.639255</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1724.392602</td>
      <td>1250.186154</td>
      <td>294.045982</td>
      <td>19.725027</td>
    </tr>
    <tr>
      <th>2</th>
      <td>419.186355</td>
      <td>1268.322106</td>
      <td>294.170612</td>
      <td>19.728998</td>
    </tr>
    <tr>
      <th>3</th>
      <td>902.256353</td>
      <td>1206.209789</td>
      <td>294.124590</td>
      <td>19.722561</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1696.768721</td>
      <td>562.242566</td>
      <td>294.049953</td>
      <td>19.663274</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>654</th>
      <td>1471.934583</td>
      <td>2031.989426</td>
      <td>294.068588</td>
      <td>19.795722</td>
    </tr>
    <tr>
      <th>655</th>
      <td>1948.153033</td>
      <td>1610.327001</td>
      <td>294.023907</td>
      <td>19.756971</td>
    </tr>
    <tr>
      <th>656</th>
      <td>1561.509786</td>
      <td>1794.601911</td>
      <td>294.060488</td>
      <td>19.774233</td>
    </tr>
    <tr>
      <th>657</th>
      <td>2003.091878</td>
      <td>1433.274841</td>
      <td>294.019005</td>
      <td>19.740964</td>
    </tr>
    <tr>
      <th>658</th>
      <td>1237.617490</td>
      <td>1228.616455</td>
      <td>294.092516</td>
      <td>19.723973</td>
    </tr>
  </tbody>
</table>
<p>659 rows × 4 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># You can see that the registration is correct near the center of the field but without a proper distortion model, the position in the corners can be very bad.</span>
<span class="n">im</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sl</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x7f7d4595f950&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_image_registration_7_1.png" src="_images/script_example_image_registration_7_1.png" />
</div>
</div>
</div>
<div class="section" id="Final-calibration">
<h2>Final calibration<a class="headerlink" href="#Final-calibration" title="Permalink to this headline">¶</a></h2>
<p>The obtained wcs is used as an input for the final calibration. Now the whole field of view can be considered.</p>
<p>A few passes may be necessary to get a good enough astrometrical precision in the corners. But don’t try to get something perfect here (above all with cubes obtained before the optical upgrade of 2020 - <a class="reference external" href="http://www.cfht.hawaii.edu/en/news/SITELLEUpgrade/">http://www.cfht.hawaii.edu/en/news/SITELLEUpgrade/</a>), the distortion is very important and capturing the stars in the corners may worsen the astrometrical precision in the center.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">im</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;M1-71.deep_frame.wcs.init.hdf5&#39;</span><span class="p">)</span>
<span class="n">wcs</span><span class="p">,</span> <span class="n">dxmap</span><span class="p">,</span> <span class="n">dymap</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">skip_registration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute_distortion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_error_maps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_radius_coeff</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sip_order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_stars_detect</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;M1-71.deep_frame.wcs.sip1.hdf5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:root:Computing WCS
INFO:root:initial wcs
INFO:root:WCS Transformation

This transformation has 2 pixel and 2 world dimensions

Array shape (Numpy order): (2064, 2048)

Pixel Dim  Data size  Bounds
        0       2048  None
        1       2064  None

World Dim  Physical Type  Units
        0  pos.eq.ra      deg
        1  pos.eq.dec     deg

Correlation between pixel and world axes:

           Pixel Dim
World Dim    0    1
        0  yes  yes
        1  yes  yes
INFO:root:initial sip: None
INFO:root:Sending query to VizieR server (catalog: gaia2)
INFO:root:Looking for stars at RA: 294.113293 DEC: 19.706693
INFO:root:14059 stars recorded in the given field
INFO:root:Magnitude min: 9.5522, max:21.0
INFO:root:5753 stars detected
INFO:root:star list reduced to 200 stars
INFO:root:Detected stars FWHM : 3.22(0.11) pixels, 1.04(0.04) arc-seconds
INFO:root:Computing SIP coefficients
INFO:root:sip before sip fit (A matrix)
INFO:root:no sip
INFO:root:sip computed with 4000 stars
INFO:root:3745 stars fitted
INFO:root:Optimized average radius for direct transformation (in pixel) 3.3457407284985066
INFO:root:Optimized average radius for reverse transformation (in pixel) 6.971630626817465e-09
INFO:root:sip after sip fit (A matrix)
INFO:root:[[-2.33140073e-09  1.05467159e-04  3.69628840e-09 -6.76514129e-10
   7.69110989e-13]
 [ 1.58698975e-09  2.38309823e-09 -1.68439216e-09 -1.68141704e-12
   0.00000000e+00]
 [ 1.09299987e-06  1.41609573e-09 -3.67666881e-12  0.00000000e+00
   0.00000000e+00]
 [-4.70860701e-09  1.27235285e-12  0.00000000e+00  0.00000000e+00
   0.00000000e+00]
 [-6.70326658e-13  0.00000000e+00  0.00000000e+00  0.00000000e+00
   0.00000000e+00]]
INFO:root:Computing distortion maps
INFO:root:distortion maps computed with 4000 stars
INFO:root:distortion maps computed with 2409 good stars
/home/thomas/Astro/Python/ORB/Orb/orb/ext/zern.py:300: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  wf_zern_vec = np.linalg.lstsq((zern_basismat[:, grid_vec] * weight).T, wf_w.ravel())[0]
INFO:root:Standard deviation of the residual: 0.6869370369065136
INFO:root:Median relative error (err/val)): 33.70%
INFO:root:Standard deviation of the residual: 0.6838007029545435
INFO:root:Median relative error (err/val)): 30.54%
INFO:root:computing full sized dxdymaps (error maps)
INFO:root:Computing astrometrical precision
INFO:root:Astrometrical precision [in arcsec]: 0.140 [+/-0.075] computed over 3042 stars
INFO:root:corrected WCS computed
INFO:root:internal WCS updated (to update the file on disk use self.writeto function)
</pre></div></div>
</div>
</div>
<div class="section" id="Check-the-results">
<h2>Check the results<a class="headerlink" href="#Check-the-results" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">im</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s1">&#39;M1-71.deep_frame.wcs.sip1.hdf5&#39;</span><span class="p">)</span>
<span class="n">sl</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">get_stars_from_catalog</span><span class="p">(</span><span class="n">max_stars</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">wcs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sl</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:root:Sending query to VizieR server (catalog: gaia2)
INFO:root:Looking for stars at RA: 294.113336 DEC: 19.706637
INFO:root:1000 stars recorded in the given field
INFO:root:Magnitude min: 9.5522, max:17.1968
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/script_example_image_registration_11_1.png" src="_images/script_example_image_registration_11_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="script_example_hst_flux_calibration.html" class="btn btn-neutral float-right" title="Flux Calibration Example Using HST image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="script_example_wavelength_calibration.html" class="btn btn-neutral float-left" title="Wavelength recalibration with the sky lines (Mendel OH bands)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2024, Thomas Martin (thomas.martin.1@ulaval.ca).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>